---
title: "Data Generating Mechanism"
author: "Alex Carriero"
output: html_document
---
```{r}
# add noise the number of people selected in each group so ev is not the same every time 

# What we can vary: 

# predictor means within groups     
# predictor means between groups 

# predictor variance within groups 
# predictor variance between groups 

# predictor covariance within groups 
# predictor covariance between groups 
```

# proof of concept example
```{r}
# Distinct Distributions for Classes 
library(tidyverse)
library(MASS)
library(pROC)
library(tableone)
```

```{r}
scenario <- function(npred){

x <- 0.3                      # mean difference between classes 
y <- 0.3                      # varcov difference between classes 

npred <-  npred 
mu    <-  c(rep(0,npred))              # vector of means
delta <-  c(rep(x,npred))              # vector of deltas (between class mean differences)
sigma <-  diag(npred)                  # varcov matrix
dsig  <-  diag(c(rep(y, npred)))       # matrix of deltas (between class varcov differences)

return(list(npred, mu, delta, sigma, dsig))
}
```

```{r}
generate_data <- function(inn, ev = 0.2){
  
  npred = inn[[1]]
  mu    = inn[[2]]
  delta = inn[[3]]
  sigma = inn[[4]]
  dsig  = inn[[5]]
  
  # calculate sample size   
  n = 1000 
  
  # positive class
  n1 <- ev*n
  mu1 <- mu + delta
  s1  <- sigma - dsig
  class_1 <- mvrnorm(n1, mu1, s1)

  # negative class
  n0  <- (1-ev)*n
  mu0 <- mu
  s0  <- sigma
  class_0 <- mvrnorm(n0, mu0, s0)

  outcome <- c(rep(1, n1), rep(0, n0))

  # format data frame
  df <- cbind(rbind(class_1, class_0), outcome)%>% 
        as.data.frame() %>% 
        mutate(outcome = as.factor(outcome))
  
  return(df)
}
```

```{r, warning = F, message = F}
# view summary statistics
summ <- function(df){
  a <- CreateTableOne(data = df, strat = "outcome")
  return(a)
}
```

```{r, warning = F, message = F}
visualize <- function(df){
  df <- df 
  df %>%
  arrange(outcome)%>%
  ggplot(aes(x = V1, y = V2, col = outcome)) + 
  geom_point(alpha = 0.7) + 
  theme_minimal() + 
  ggtitle("Simulated Data:") + 
  scale_color_manual("Class", values = c("goldenrod1", "darkblue")) + 
  xlab("Predictor 1") +
  ylab("Predictor 2")
}
```

```{r}
# discrimination 
get_auc <- function(df){
  
mod  <- glm(outcome~., family = "binomial", data = df)
pred <- predict(mod, type="response")
auc  <- auc(df$outcome, pred)

return(auc)
}
```


```{r}
# generate data
df <- generate_data(scenario(npred = 8), ev = 0.2)
df
```

```{r}
# all together
summ(df) 
get_auc(df)
visualize(df)
```

# test scenarios 

```{r, message = F}
# simulation to determine mean and variance values: get appropriate auc 
set.seed(311)
auc <- c()

for (i in 1:2000){                                          
  df      <- generate_data(scenario(npred = 8), ev = 0.2)
  auc[i]  <- get_auc(df)
}

mean(auc)   # 0.75
sd(auc)     # 0.02
```
